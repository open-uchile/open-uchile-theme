<%page expression_filter="h"/>
<%!
  import json
  from django.utils.translation import ugettext as _
  from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
%>
<%inherit file="../main.html" />
<%
  course_discovery_enabled = settings.FEATURES.get('ENABLE_COURSE_DISCOVERY')
%>
<%
  from django.utils import timezone
  now = timezone.now()
%>
<%namespace name='static' file='../static_content.html'/>

% if course_discovery_enabled:
<%block name="header_extras">
  % for template_name in ["course_card", "filter_bar", "filter", "facet", "facet_option"]:
  <script type="text/template" id="${template_name}-tpl">
      <%static:include path="discovery/${template_name}.underscore" />
  </script>
  % endfor
</%block>
% endif
<%block name="js_extra">
  <script type="text/javascript" src="${static.url('open-uchile-theme/js/open_search.js')}"></script>
</%block>
<%block name="pagetitle">${_("Courses")}</%block>
<style>
  .collapse:not(.show) {
    display: block;
  }
  #open-carousel{
    max-height: 560px;
  }
  .find-courses{
    background: transparent;
  }
</style>
<main id="main" aria-label="Content" tabindex="-1">
  <!--header>
    <div id="open-carousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#open-carousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#open-carousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#open-carousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="https://virtual-labx.uchile.cl/static/virtual-labx-theme/images/edx_02.09d7413bd248.jpg" class="d-block w-100" alt="...">
        </div>
        <div class="carousel-item">
          <img src="https://virtual-labx.uchile.cl/static/virtual-labx-theme/images/sld_1.0179282467f7.jpg" class="d-block w-100" alt="...">
        </div>
        <div class="carousel-item">
          <img src="https://virtual-labx.uchile.cl/static/virtual-labx-theme/images/edx_01.1a4dd3e883e9.jpg" class="d-block w-100" alt="...">
        </div>
      </div>
      <a class="carousel-control-prev" href="#open-carousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </a>
      <a class="carousel-control-next"  href="#open-carousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </a>
    </div>
  </header-->
    <section class="find-courses">
      <section class="courses-container">
        % if course_discovery_enabled:
        <div id="discovery-form" role="search" aria-label="course" class="wrapper-search-context">
          <div id="discovery-message" class="search-status-label"></div>
          <form class="wrapper-search-input">
            <label for="discovery-input" class="sr">${_('Search for a course')}</label>
            <input id="discovery-input" class="discovery-input" placeholder="${_('Search for a course')}" type="text"/>
            <button type="submit" id="discovery-submit"  class="button postfix discovery-submit" title="${_('Search')}">
              <span class="icon fa fa-search" aria-hidden="true"></span>
              <div aria-live="polite" aria-relevant="all">
                <div id="loading-indicator" class="loading-spinner hidden">
                  <span class="icon fa fa-spinner fa-spin" aria-hidden="true"></span>
                  <span class="sr">${_('Loading')}</span>
                </div>
              </div>
            </button>
          </form>
        </div>

        <div id="filter-bar" class="filters hide-phone is-collapsed">
          <div class="filters-inner">
            <ul id="active-filters" class="active-filters facet-list"></ul>
            <button id="clear-all-filters" class="clear-filters flt-right discovery-button">${_('Clear All')}</button>
          </div>
        </div>
        % endif

        <div class="courses${'' if course_discovery_enabled else ' no-course-discovery'}" role="region" aria-label="${_('List of Courses')}">
          <ul class="courses-listing courses-list" id="list-courses">
            %for course in courses:
              %if course.end is not None and course.end > now:
                %if course.enrollment_start is not None and course.enrollment_end is not None:
                  %if course.enrollment_end > now:
                    %if course.id.course[-2:] == '_E':
                      <li class="courses-listing-item courses-english">
                        <%include file="../course.html" args="course=course" />
                      </li>
                    %else:
                      <li class="courses-listing-item courses-spanish">
                        <%include file="../course.html" args="course=course" />
                      </li>
                    %endif
                  %endif
                %endif
              %elif course.end is None:
                %if course.enrollment_start is not None and course.enrollment_end is not None:
                  %if course.enrollment_end > now:
                    %if course.id.course[-2:] == '_E':
                      <li class="courses-listing-item courses-english">
                        <%include file="../course.html" args="course=course" />
                      </li>
                    %else:
                      <li class="courses-listing-item courses-spanish">
                        <%include file="../course.html" args="course=course" />
                      </li>
                    %endif
                  %endif
                %endif
              %endif
            %endfor
          </ul>
          <ul class="courses-listing courses-list" id="list-courses_orgs"></ul>
        </div>


        % if course_discovery_enabled:
        <aside aria-label="${_('Refine Your Search')}" class="search-facets phone-menu">
          <h2 class="header-search-facets">${_('Refine Your Search')}</h2>
          <section class="search-facets-lists">
            <h3 class="header-facet" data-text="Sort by:">${_('Sort by:')}</h3>
            <ul data-facet="order_by" class="facet-list collapse">
              <li>
                <button data-facet="order_by" data-value="newer" data-text="Newer" class="facet-option discovery-button order_by">
                  ${_('Newer')} 
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="order_by" data-value="older" data-text="Older" class="facet-option discovery-button order_by">
                  ${_('Older')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
            </ul>
            <h3 class="header-facet" data-text="Year:">${_('Year:')}</h3>
            <ul data-facet="year" class="facet-list collapse">
              <li>
                <button data-facet="year" data-value="2023" data-text="2023" class="facet-option discovery-button year">
                  2023
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="year" data-value="2024" data-text="2024" class="facet-option discovery-button year">
                  2024
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
            </ul>
            <h3 class="header-facet" data-text="State:">${_('State:')}</h3>
            <ul data-facet="state" class="facet-list collapse">
              <li>
                <button data-facet="state" data-value="active" data-text="Active" class="facet-option discovery-button state">
                  ${_('Active')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="state" data-value="finished" data-text="Finished" class="facet-option discovery-button state">
                  ${_('Finished')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
            </ul>
            <h3 class="header-facet" data-text="Organizations:">${_('Organizations:')}</h3>
            <ul data-facet="open_org" class="facet-list collapse">
              <li>
                <button data-facet="open_org" data-value="CLIL" data-text="${_('Universität Heidelberg')}" class="facet-option discovery-button open_org">
                  ${_('Universität Heidelberg')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="CMS" data-text="${_('Facultad de Ciencias Físicas y Matemáticas')}" class="facet-option discovery-button open_org">
                  ${_('Facultad de Ciencias Físicas y Matemáticas')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="DCS" data-text="${_('Facultad de Economía y Negocios')}" class="facet-option discovery-button open_org">
                  ${_('Facultad de Economía y Negocios')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="DEM" data-text="${_('Facultad de Medicina')}" class="facet-option discovery-button open_org">
                  ${_('Facultad de Medicina')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="ECBI" data-text="${_('ECBI Chile')}" class="facet-option discovery-button open_org">
                  ${_('ECBI Chile')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="CR2" data-text="${_('Centro de Ciencia del Clima y la Resiliencia (CR)^2')}" class="facet-option discovery-button open_org">
                  ${_('Centro de Ciencia del Clima y la Resiliencia (CR)^2')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
              <li>
                <button data-facet="open_org" data-value="REUNA" data-text="${_('Red Universitaria Nacional (REUNA)')}" class="facet-option discovery-button open_org">
                  ${_('Red Universitaria Nacional (REUNA)')}
                  <span class="count"><span class="count-number"></span></span>
                </button>
              </li>
            </ul>
          </section>
        </aside>
        % endif

      </section>
    </section>
</main>
